# 효율적 쿼리

## 서브쿼리와 조인
서브 쿼리는 다른 SQL문이 포함된 SQL문을 의미하며 조인은 2개의 테이블을 하나로 합치는 것을 의미합니다. 서브 쿼리와 조인은 엄연히 별개의 개념이지만, 비슷한 상황에 사용되고 있습니다.

서브 쿼리에는 다양한 유형이 있지만 간단한 예시를 보면 아래와 같습니다

```sql
select
  users.username,
  (select count(*)
   from posts
   where posts.user_id = users.user_id) as post_count
from users;
```

조인은 크게 INNER 조인과 OUTER 조인으로 나뉩니다. OUTER 조인은 LEFT OUTER, RIGHT OUTER, FULL OUTER 조인으로 구분됩니다.

<img width="502" alt="image" src="https://github.com/user-attachments/assets/bb114260-870e-46e5-8a06-06b81a0ff75e" />

보통 조인이라고 하면 INNER 조인을 의미하며 조건을 만족하지 않는 레코드도 조회하고 싶을 때는 OUTER 조인을 사용합니다.

또한 FULL OUTER 조인은 대부분의 RDBMS에서 문법을 지원하지 않기 때문에 LEFT OUTER 조인의 결과와 RIGHT OUTER 조인의 결과를 UNION 연산을 통해 구현할 수 있습니다.

## 뷰

서브 쿼리를 여러 SQL문에서 사용하고자 할 때, 해당 서브 쿼리를 SQL문마다 작성한다면 중복되는 쿼리가 많아 번거롭습니다.

이 때 가상의 테이블인 뷰를 사용하면 SQL문을 단순화할 수 있습니다. 뷰의 종류에 따라 삽입, 수정, 삭제에 대한 제약 조건이 있을 수도 있습니다.

## 인덱스

인덱스는 검색 속도 향상을 위해 사용하는 자료구조입니다. 보통 책의 '목차', '찾아보기'에 많이 비유됩니다. 

책의 목차가 없다면 원하는 내용을 찾기 위해 책의 모든 내용을 뒤져봐야 하듯이, 테이블에 인덱스가 없다면 테이블 전체를 찾아봐야 할 수도 있습니다.

MySQL 기준으로 인덱스는 클러스터형 인덱스와 세컨더리 인덱스로 구분됩니다.

클러스터형 인덱스는 테이블 당 하나씩 만들 수 있는 인덱스로 기본 키입니다. 만약 테이블에 기본 키가 없다면 Not Null 조건이나 Unique 조건이 있는 필드가 클러스터형 인덱스가 됩니다.

세컨더리 인덱스는 논클러스터형 인덱스라고도 부르는데 일반적으로 클러스터형 인덱스보단 검색 속도가 느립니다. 

대부분의 RDBMS에서는 인덱스로 B 트리 혹은 B+ 트리 자료구조를 사용합니다. 



그렇기에 인덱스는 항상 키 값을 기준으로 정렬되어 있습니다. 따라서 인덱스는 조회 성능은 향상시킬 수 있지만 그 외의 삽입/수정/삭제 연산에 대해서는 굉장히 느린 성능을 보입니다.

그래서 조회 연산이 적은 경우, 수정 연산이 많은 경우 인덱스를 생성하면 오히려 성능 저하가 발생할 수 있습니다.


